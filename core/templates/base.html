<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}SB Finance AI{% endblock %}</title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* ============================================================================
           MODERN FINTECH UI - Top-tier design inspired by Stripe, Linear, Notion, Wise
           ============================================================================ */
        :root {
          /* Brand Colors - Modern Fintech Blue */
          --brand: #2563eb;
          --brand-600: #2256A0;
          --brand-hover: #1d4ed8;
          --brand-light: rgba(37, 99, 235, 0.1);
          
          /* Text Colors - High Contrast */
          --ink-900: #0f172a;
          --ink-700: #1e293b;
          --ink-500: #64748b;
          --ink-300: #94a3b8;
          --ink-100: #cbd5e1;
          
          /* Background - Clean White (ChatGPT/Stripe style) */
          --bg-soft: #FFFFFF;
          --bg-elev: #FFFFFF;
          --bg-hover: #F8F9FA;
          
        /* Grid colors for charts */
          --grid-color: rgba(15, 23, 42, 0.06);
          
          /* Borders - Subtle */
          --border: rgba(15, 23, 42, 0.08);
          --border-hover: rgba(15, 23, 42, 0.12);
          
          /* Card Styling - Claymorphism */
          --card-radius: 18px;
          --card-shadow: 0 2px 8px rgba(15, 23, 42, 0.04), 0 1px 3px rgba(15, 23, 42, 0.06);
          --card-shadow-hover: 0 8px 24px rgba(15, 23, 42, 0.08), 0 4px 12px rgba(15, 23, 42, 0.06);
          
          /* Spacing */
          --gap-1: 6px; --gap-2: 10px; --gap-3: 16px; --gap-4: 24px; --gap-5: 32px;
          
          /* Success/Error Colors - Vibrant */
          --success: #39C07D;
          --success-light: rgba(57, 192, 125, 0.1);
          --success-hover: #2ea866;
          --danger: #e11d48;
          --danger-light: rgba(225, 29, 72, 0.1);
          --danger-hover: #be1e3e;
          --warning: #f59e0b;
          --warning-light: rgba(245, 158, 11, 0.1);
          
          /* Focus Ring */
          --focus-ring: 0 0 0 3px rgba(37, 99, 235, 0.2);
          
          /* Typography */
          --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        
        * { font-family: var(--font-family); }
        body { 
          background: var(--bg-soft); 
          color: var(--ink-900);
          font-weight: 400;
          line-height: 1.6;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }
        
        /* Navbar - Floating, Modern */
        .navbar {
          background: rgba(255, 255, 255, 0.85) !important;
          backdrop-filter: blur(12px) saturate(180%);
          -webkit-backdrop-filter: blur(12px) saturate(180%);
          border-bottom: 1px solid var(--border);
          box-shadow: 0 1px 3px rgba(15, 23, 42, 0.04);
          padding: 12px 0;
        }
        .navbar-brand { 
          font-weight: 800; 
          letter-spacing: -0.02em;
          font-size: 1.25rem;
          color: var(--ink-900) !important;
        }
        .nav-link {
          font-weight: 500;
          color: var(--ink-700) !important;
          transition: color 0.2s ease;
          padding: 8px 12px !important;
          border-radius: 8px;
        }
        .nav-link:hover {
          color: var(--brand) !important;
          background: var(--brand-light);
        }
        
        /* Content */
        .content-wrap { padding-top: 32px; padding-bottom: 48px; }
        
        /* Cards - Clean Modern Style (ChatGPT/Stripe) */
        .app-card { 
          border-radius: var(--card-radius); 
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.04);
          border: 1px solid var(--border); 
          background: var(--bg-elev);
          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
          padding: 32px;
        }
        .app-card:hover { 
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
          transform: translateY(-1px);
        }
        
        /* KPI Cards - Stripe/ChatGPT Style */
        .kpi-card {
          border-radius: 16px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
          border: 1px solid var(--border);
          background: var(--bg-elev);
          padding: 32px;
          transition: all 0.2s ease;
          position: relative;
        }
        .kpi-card:hover {
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          transform: translateY(-2px);
        }
        .kpi-card.income { border-left: 4px solid var(--success); }
        .kpi-card.expense { border-left: 4px solid var(--danger); }
        .kpi-card.profit { border-left: 4px solid var(--brand); }
        
        .kpi { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 24px; }
        .kpi-card {
          display: flex;
          flex-direction: column;
          gap: 12px;
        }
        .kpi-card .label {
          font-size: 0.875rem;
          font-weight: 500;
          color: var(--ink-500);
          display: flex;
          align-items: center;
          gap: 8px;
        }
        .kpi-card .value { 
          font-size: 2.5rem; 
          font-weight: 700; 
          letter-spacing: -0.03em;
          line-height: 1.1;
        }
        
        /* Buttons - Modern with Gradients */
        .btn {
          border-radius: 14px;
          font-weight: 600;
          padding: 10px 20px;
          transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
          border: none;
          position: relative;
          overflow: hidden;
        }
        .btn-primary {
          background: linear-gradient(135deg, var(--brand) 0%, var(--brand-600) 100%);
          color: white;
          box-shadow: 0 2px 8px rgba(37, 99, 235, 0.25);
        }
        .btn-primary:hover {
          background: linear-gradient(135deg, var(--brand-hover) 0%, var(--brand) 100%);
          box-shadow: 0 4px 12px rgba(37, 99, 235, 0.35);
          transform: translateY(-1px);
          color: white;
        }
        .btn-success {
          background: linear-gradient(135deg, var(--success) 0%, var(--success-hover) 100%);
          color: white;
          box-shadow: 0 2px 8px rgba(57, 192, 125, 0.25);
        }
        .btn-success:hover {
          box-shadow: 0 4px 12px rgba(57, 192, 125, 0.35);
          transform: translateY(-1px);
          color: white;
        }
        .btn-danger {
          background: linear-gradient(135deg, var(--danger) 0%, var(--danger-hover) 100%);
          color: white;
          box-shadow: 0 2px 8px rgba(225, 29, 72, 0.25);
        }
        .btn-danger:hover {
          box-shadow: 0 4px 12px rgba(225, 29, 72, 0.35);
          transform: translateY(-1px);
          color: white;
        }
        .btn-outline-primary {
          border: 2px solid var(--brand);
          color: var(--brand);
          background: transparent;
        }
        .btn-outline-primary:hover {
          background: var(--brand);
          color: white;
          transform: translateY(-1px);
          box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
        }
        .btn-outline-secondary {
          border: 2px solid var(--border);
          color: var(--ink-700);
          background: transparent;
        }
        .btn-outline-secondary:hover {
          background: var(--bg-hover);
          border-color: var(--border-hover);
          transform: translateY(-1px);
        }
        .btn-sm {
          padding: 6px 14px;
          font-size: 0.875rem;
        }
        
        /* Forms - Modern Selects */
        .form-control, .form-select {
          border-radius: 12px;
          border: 2px solid var(--border);
          padding: 10px 16px;
          font-size: 0.9375rem;
          transition: all 0.2s ease;
          background: var(--bg-elev);
        }
        .form-control:focus, .form-select:focus {
          border-color: var(--brand);
          box-shadow: var(--focus-ring);
          outline: none;
        }
        .form-select {
          background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
          background-repeat: no-repeat;
          background-position: right 12px center;
          background-size: 16px;
          padding-right: 40px;
          appearance: none;
        }
        [data-theme="dark"] .form-select {
          background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23E6E8EC' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
        }
        
        /* Tables - Styled */
        .table {
          border-collapse: separate;
          border-spacing: 0;
        }
        .table thead th {
          font-weight: 600;
          color: var(--ink-700);
          text-transform: uppercase;
          font-size: 0.75rem;
          letter-spacing: 0.05em;
          padding: 16px;
          border-bottom: 2px solid var(--border);
          background: var(--bg-hover);
        }
        .table tbody tr {
          transition: all 0.15s ease;
          border-bottom: 1px solid var(--border);
        }
        .table tbody tr:hover {
          background: var(--bg-hover);
          transform: scale(1.001);
        }
        .table tbody td {
          padding: 16px;
          vertical-align: middle;
        }
        
        /* Badges - Modern Pills */
        .badge {
          border-radius: 999px;
          padding: 6px 12px;
          font-weight: 500;
          font-size: 0.75rem;
          letter-spacing: 0.02em;
        }
        .badge.bg-secondary {
          background: var(--ink-100) !important;
          color: var(--ink-700) !important;
        }
        .badge.bg-info {
          background: var(--brand-light) !important;
          color: var(--brand) !important;
        }
        .badge.bg-success {
          background: var(--success-light) !important;
          color: var(--success) !important;
        }
        .badge.bg-danger {
          background: var(--danger-light) !important;
          color: var(--danger) !important;
        }
        
        /* Action Buttons in Tables - Hidden until hover */
        .table tbody tr .btn-group {
          opacity: 0;
          transition: opacity 0.2s ease;
        }
        .table tbody tr:hover .btn-group {
          opacity: 1;
        }
        .btn-group-sm .btn {
          padding: 4px 8px;
          border-radius: 8px;
        }
        
        /* Alerts */
        .alert {
          border-radius: 12px;
          border: 1px solid var(--border);
          padding: 16px 20px;
        }
        
        /* Section Titles */
        .app-section-title { 
          font-weight: 700; 
          letter-spacing: -0.01em;
          color: var(--ink-900);
          font-size: 1.125rem;
        }
        
        /* Utilities */
        .muted { color: var(--ink-500); }
        .footer { color: var(--ink-500); }
        .btn-icon { display: inline-flex; align-items: center; gap: 8px; }
        .actions { display: flex; gap: var(--gap-2); flex-wrap: wrap; align-items: center; }
        
        /* Text Colors */
        .text-success { color: var(--success) !important; }
        .text-danger { color: var(--danger) !important; }
        .text-warning { color: var(--warning) !important; }
        .text-primary { color: var(--brand) !important; }
        
        /* Animations */
        .fade-in { animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) both; }
        @keyframes fadeIn { 
          from { opacity: 0; transform: translateY(8px); } 
          to { opacity: 1; transform: translateY(0); } 
        }
        .pulse { animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) 2; }
        @keyframes pulse { 
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.8; transform: scale(1.02); }
        }
        
        /* Progress Bar - Stripe/Linear style */
        .progress {
          height: 8px;
          border-radius: 999px;
          background: var(--bg-hover);
          overflow: hidden;
          box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        .progress-bar {
          background: linear-gradient(90deg, var(--brand), var(--brand-600));
          border-radius: 999px;
          transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          box-shadow: 0 1px 3px rgba(37, 99, 235, 0.3);
        }
        .progress-bar-striped {
          background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);
          background-size: 1rem 1rem;
        }
        .progress-bar-animated {
          animation: progress-bar-stripes 1s linear infinite;
        }
        @keyframes progress-bar-stripes {
          0% { background-position: 1rem 0; }
          100% { background-position: 0 0; }
        }
        
        /* Toast Container */
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 1080; }
        .loader-inline { display: inline-flex; align-items: center; gap: 8px; }
        .soft-badge { 
          background: var(--brand-light); 
          color: var(--brand); 
          border-radius: 999px; 
          padding: 4px 12px; 
          font-size: 0.75rem;
          font-weight: 500;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
          .kpi { grid-template-columns: 1fr; }
          .navbar .btn { padding: 6px 12px; }
          .app-card { padding: 16px; }
          .kpi-card { padding: 20px; }
        }
        
        /* ============================================================================
           DARK MODE - ChatGPT/Linear/Notion style (Quality dark theme)
           ============================================================================ */
        [data-theme="dark"] { color-scheme: dark; }
        [data-theme="dark"] :root {
          --bg-soft: #000000;
          --bg-elev: #0D0D0D;
          --bg-hover: #1A1A1A;
          --ink-900: #ECECEC;
          --ink-700: #D1D1D1;
          --ink-500: #A8A8A8;
          --ink-300: #8A8A8A;
          --ink-100: #6A6A6A;
          --border: rgba(255, 255, 255, 0.1);
          --border-hover: rgba(255, 255, 255, 0.15);
          --card-shadow: 0 4px 16px rgba(0, 0, 0, 0.6), 0 2px 8px rgba(0, 0, 0, 0.4);
          --card-shadow-hover: 0 8px 32px rgba(0, 0, 0, 0.8), 0 4px 16px rgba(0, 0, 0, 0.5);
          --grid-color: rgba(255, 255, 255, 0.06);
        }
        [data-theme="dark"] body { 
          background: var(--bg-soft); 
          color: var(--ink-900);
        }
        [data-theme="dark"] .content-wrap {
          background: var(--bg-soft);
        }
        [data-theme="dark"] .navbar {
          background: rgba(0, 0, 0, 0.95) !important;
          border-bottom-color: var(--border);
        }
        [data-theme="dark"] .navbar-brand {
          color: var(--ink-900) !important;
        }
        [data-theme="dark"] .app-card, 
        [data-theme="dark"] .card, 
        [data-theme="dark"] .table {
          background: var(--bg-elev);
          color: var(--ink-900);
          border-color: var(--border);
        }
        [data-theme="dark"] .table thead th {
          background: var(--bg-hover);
          color: var(--ink-700);
          border-bottom-color: var(--border);
        }
        [data-theme="dark"] .table tbody tr:hover {
          background: var(--bg-hover);
        }
        [data-theme="dark"] .form-control, 
        [data-theme="dark"] .form-select {
          background: var(--bg-elev);
          color: var(--ink-900);
          border-color: var(--border);
        }
        [data-theme="dark"] .form-control:focus,
        [data-theme="dark"] .form-select:focus {
          border-color: var(--brand);
          background: var(--bg-hover);
        }
        [data-theme="dark"] .alert {
          background: var(--bg-elev);
          border-color: var(--border);
          color: var(--ink-900);
        }
        [data-theme="dark"] .badge.bg-secondary {
          background: var(--bg-hover) !important;
          color: var(--ink-700) !important;
        }
        [data-theme="dark"] .muted {
          color: var(--ink-500);
        }
        [data-theme="dark"] .footer {
          color: var(--ink-500);
        }
    </style>
    {% block extra_head %}{% endblock %}
    <script>
      (function() {
        const saved = localStorage.getItem('theme');
        if (saved) document.documentElement.setAttribute('data-theme', saved);
      })();
    </script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'><text y='1em' font-size='96'>üíº</text></svg>">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light border-bottom sticky-top">
      <div class="container">
        <a class="navbar-brand" href="/">SB Finance AI</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="mainNav">
          {% if user.is_authenticated %}
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="{% url 'workspace' %}">–ß–∞—Ç</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'dashboard' %}">–î—ç—à–±–æ—Ä–¥</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'income_list' %}">–î–æ—Ö–æ–¥—ã</a></li>
            <li class="nav-item"><a class="nav-link" href="{% url 'expense_list' %}">–†–∞—Å—Ö–æ–¥—ã</a></li>
          </ul>
          {% endif %}
          <div class="d-flex gap-2">
            {% if user.is_authenticated %}
              <span class="text-muted me-2" style="line-height: 2.2;">{{ user.username }}</span>
              <a class="btn btn-outline-secondary btn-sm" href="{% url 'logout' %}"><i class="bi bi-box-arrow-right"></i> –í—ã—Ö–æ–¥</a>
            {% else %}
              <a class="btn btn-outline-primary btn-sm" href="{% url 'login' %}"><i class="bi bi-box-arrow-in-right"></i> –í—Ö–æ–¥</a>
              <a class="btn btn-primary btn-sm" href="{% url 'register' %}"><i class="bi bi-person-plus"></i> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            {% endif %}
            <button id="themeToggle" class="btn btn-outline-primary btn-sm" type="button"><i class="bi bi-moon-stars"></i></button>
          </div>
        </div>
      </div>
    </nav>

    <main class="content-wrap container">
      {% if messages %}
        <div class="mb-3">
          {% for message in messages %}
            <div class="alert alert-info d-flex align-items-center gap-2" role="alert">
              <i class="bi bi-info-circle"></i>
              <div>{{ message }}</div>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      {% block content %}{% endblock %}
    </main>

    <footer class="border-top py-3">
      <div class="container d-flex justify-content-between align-items-center footer">
        <small>¬© {{ now|default:2025 }} SB Finance AI</small>
        <small>–í–µ—Ä—Å–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞: 1.1</small>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.getElementById('themeToggle').addEventListener('click', function() {
        const html = document.documentElement;
        const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
        this.innerHTML = next === 'dark' ? '<i class="bi bi-brightness-high"></i>' : '<i class="bi bi-moon-stars"></i>';
        document.dispatchEvent(new CustomEvent('theme:changed', { detail: { theme: next }}));
      });
    </script>
    <div class="toast-container" id="toastContainer"></div>
    <script>
      function showToast(message, variant='info', timeout=2800) {
        const wrap = document.getElementById('toastContainer');
        const id = 't' + Math.random().toString(36).slice(2,8);
        const colorMap = { info: 'primary', success: 'success', warning: 'warning', danger: 'danger' };
        const el = document.createElement('div');
        el.className = 'toast align-items-center text-bg-' + (colorMap[variant] || 'primary') + ' border-0 fade show';
        el.id = id;
        el.role = 'alert';
        el.ariaLive = 'assertive';
        el.ariaAtomic = 'true';
        el.innerHTML = '<div class="d-flex"><div class="toast-body">' + message + '</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>';
        wrap.appendChild(el);
        setTimeout(() => { try { el.remove(); } catch(e){} }, timeout);
      }
    </script>
  </body>
</html>

